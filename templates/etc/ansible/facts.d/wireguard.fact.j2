#!{{ ansible_python['executable'] }}
# -*- coding: utf-8 -*-

# Copyright (C) 2020 Robin Schneider <ypid@riseup.net>
# Copyright (C) 2020 DebOps <https://debops.org/>
# SPDX-License-Identifier: GPL-3.0-or-later

# {{ ansible_managed }}

from __future__ import print_function
from json import loads, dumps
from sys import exit

{% set facts_interfaces = {} %}
{% for host in ansible_play_hosts %}
{%   set _ = facts_interfaces.update({
    wireguard_interface: {
        'Interface': {
            'PublicKey': hostvars[host].wireguard__fact_public_key,
        }
    }
}) %}
{% endfor %}

output = loads('''{
    "installed": true,
    "interface": {{ facts_interfaces | to_json }}
}''')

print(dumps(output, sort_keys=True, indent=4))
